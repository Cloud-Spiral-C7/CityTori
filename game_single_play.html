<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script type="text/javascript">
var map, geocoder;

function initMap() {
  geocoder = new google.maps.Geocoder();
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 35.681382, lng: 139.766084},
    zoom: 12,
    // maxZoom: 12,
    // minZoom: 12,
    disableDefaultUI: true,
    // mapTypeId: google.maps.MapTypeId.TERRAIN,
    styles: [
      {
        featureType: 'all',
        elementType: 'labels',
        stylers: [{ visibility: 'off' }]
      },
      {
        featureType: 'administrative.locality',
        elementType: 'labels',
        stylers: [{ visibility: 'on' }]
      },
    ]
  });

  map.addListener('click', function (e) {
    geocoder.geocode({location: e.latLng}, function (addrInfo) {
      console.log(addrInfo);
      var pos = e.latLng;
      var address =
        addrInfo[0].address_components.reverse().slice(2)
        .map(function (c) { return c.long_name })
        .join('');

      analyseMorph(address).done(function (data) {
        console.log(data);
        var popup = new google.maps.InfoWindow({
          content: data.word_list[0].map(function(word) {
            return word[0] + ',' + katakanaToHiragana(word[2])
          }).join('<br>'),
          position: pos
        });
        popup.open(map);
      });
    });
  });
}

/**
 * 形態素解析を行います。(API: https://labs.goo.ne.jp/api/2015/334/)
 * @param {String} sentence - 解析対象の文
 * @returns {Object} - 形態素解析結果
 */
function analyseMorph(sentence) {
  return $.ajax({
    method: 'post',
    url: 'https://labs.goo.ne.jp/api/morph',
    data: {
      app_id: '6953432d0f5f68bbc04853cf917822f88548ceb4bec7e4e1370058c5cf6cf346',
      sentence: sentence,
    },
    dataType: 'json'
  });
}

/** カタカナをひらがなに変換する関数
 * @param {String} src - カタカナ
 * @returns {String} - ひらがな
 */
function katakanaToHiragana(src) {
	return src.replace(/[\u30a1-\u30f6]/g, function(match) {
		var chr = match.charCodeAt(0) - 0x60;
		return String.fromCharCode(chr);
	});
}
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCz-nxKgKLTvgFeMfjBLU_PkcYwpOOULR4&callback=initMap">
    </script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  </body>
</html>
